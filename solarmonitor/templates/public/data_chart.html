
{% extends "layout.html" %}

{% block content %}
<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron">

  <div class="row">
      <div class="col-md-4">
  <form class="form-horizontal" action="{{ url_for('public.charts') }}" method="post">
    {{ download_data_form.hidden_tag() }}
  <fieldset>

  <!-- Form Name -->
  <legend>Import PGE Data</legend>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">Start Date</label>
    <div class="col-md-6">
    {{ download_data_form.start_date(class="form-control input-md", id="datepicker1", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker1').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">End Date</label>
    <div class="col-md-6">
    {{ download_data_form.end_date(class="form-control input-md", id="datepicker2", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker2').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>


  <!-- Button -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton"></label>
    <div class="col-md-6">
      {{ download_data_form.submit(class="btn btn-primary") }}
    </div>
  </div>

  </fieldset>
  </form>
</div>
<div class="col-md-4">
  <form class="form-horizontal" action="{{ url_for('public.charts') }}" method="post">
    {{ date_select_form.hidden_tag() }}
  <fieldset>

  <!-- Form Name -->
  <legend>Select Data to View</legend>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">Start Date</label>
    <div class="col-md-6">
    {{ date_select_form.start_date(class="form-control input-md", id="datepicker3", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker3').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">End Date</label>
    <div class="col-md-6">
    {{ date_select_form.end_date(class="form-control input-md", id="datepicker4", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker4').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- SelectField -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton">Time Unit</label>
    <div class="col-md-4">
      {{ date_select_form.data_time_unit(class="form-control input-md") }}
    </div>
  </div>

  <!-- Button -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton"></label>
    <div class="col-md-4">
      {{ date_select_form.submit(class="btn btn-primary") }}
    </div>
  </div>

  </fieldset>
  </form>
</div>
</div>
</div><!-- /.jumbotron -->
<style type="text/css">
.datepicker {
margin-top:50px

}
</style>
<div class="row">
    <div class="col-sm-6">

    <canvas id="myChart" width="100" height="100"></canvas>

    <script>
    var data = {
    labels: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_label|safe }} {% else %}  {{ outgoing_labels|safe }} {% endif %},
    datasets: [
        {
            label: 'Outgoing Electric (Sold to Grid) kWh',
            backgroundColor: "rgba(127,191,63,0.2)",
            borderColor: "rgba(9,174,9,1)",
            borderWidth: 1,
            hoverBackgroundColor: "rgba(127,191,63,0.4)",
            hoverBorderColor: "rgba(9,174,9,1)",
            data: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_data|safe }} {% else %}  {{ outgoing_electric|safe }} {% endif %},
        },

        {
            label: 'Incoming Electric (Usage) kWh',
            backgroundColor: "rgba(255,99,132,0.2)",
            borderColor: "rgba(255,99,132,1)",
            borderWidth: 1,
            hoverBackgroundColor: "rgba(255,99,132,0.4)",
            hoverBorderColor: "rgba(255,99,132,1)",
            data: {% if session['data_time_unit'] == "Daily"%} {{ incoming_electric_daily_data|safe }} {% else %}  {{ incoming_electric|safe }} {% endif %},
        }
    ]
};
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero:true
                  }
              }]
          }
      }
    });
    </script>

    </div>


    <div class="col-sm-6">

      <canvas id="myChart3" width="100" height="100"></canvas>

      <script>
      var ctx = document.getElementById("myChart3");
      var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_label|safe }} {% else %}  {{ outgoing_labels|safe }} {% endif %},
            datasets: [{
                label: 'Combined Electric (+/-) kWh',
                data: {% if session['data_time_unit'] == "Daily"%}{{ daily_combined_electric_usage|safe }} {% else %}{{ hourly_combined_electric_usage|safe }}{% endif %} ,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }
      });
      </script>

    </div>
</div>

<div class="row">
    <div class="col-sm-4">

      <p>Debug Data</p>

  <p>Start Date: {{ session['start_date_pge'] }}<br>

  End Date:{{ session['end_date_pge'] }}</br><br>

  <a class="btn btn-primary" href="{{ url_for('public.charts', modify='clear') }}"> Clear Session</a>

  <a class="btn btn-primary" href="{{ url_for('public.charts', modify='delete-data') }}"> Clear Database</a>

  </p>

<hr>

<div class="progress">
    <div></div>
    <div>0%</div>
    <div>...</div>
    <div>&nbsp;</div>
</div>

<input id="clickMe" type="button" class="btn btn-primary" value="Check result" onclick="update_progress();" />

<script type="text/javascript">


function update_progress(status_url, nanobar, status_div) {
    // send GET request to status URL
    $.getJSON(status_url, function(data) {
        // update UI
        percent = parseInt(data['current'] * 100 / data['total']);
        nanobar.go(percent);
        $(status_div.childNodes[1]).text(percent + '%');
        $(status_div.childNodes[2]).text(data['status']);
        if (data['state'] != 'PENDING' && data['state'] != 'PROGRESS') {
            if ('result' in data) {
                // show result
                $(status_div.childNodes[3]).text('Result: ' + data['result']);
            }
            else {
                // something unexpected happened
                $(status_div.childNodes[3]).text('Result: ' + data['state']);
            }
        }
        else {
            // rerun in 2 seconds
            setTimeout(function() {
                update_progress(status_url, nanobar, status_div);
            }, 2000);
        }
    });
}
</script>
  <hr>
  Incoming Electric Daily Data<br>
  {{ incoming_electric_daily_data }}
  <hr>
  Incoming Electric Daily Labels<br>
  {{ incoming_electric_daily_label}}
  <hr>
  Incoming Electric Hourly Labels<br>
  {{ incoming_labels|safe }}
  <hr>
  Incoming Electric Hourly Data <br>
  {{ incoming_electric|safe }}
  <hr>
  Outgoing Electric Hourly Labels <br>
  {{ outgoing_labels|safe }}
  <hr>
  Outgoing Electric Hourly Data <br>
  {{ outgoing_electric|safe }}

  <br><br><br><br>



    </div>
  </div>

{% endblock %}
