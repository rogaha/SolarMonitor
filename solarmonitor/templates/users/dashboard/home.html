
{% extends "layout.html" %}

{% block header_add %}
<!-- Bootstrap Core CSS -->
<link href="{{ url_for('static', filename='css/energy_account_table.css') }}" rel="stylesheet">
{% endblock %}

{% block heading %}
{{ heading }}
{% endblock %}

{% block sub_heading %}
{{ sub_heading }}
{% endblock %}

{% block breadcrumbs %}
  {% for crumb, icon, url in breadcrumbs %}
    <li>
        <i class="fa fa-{{ icon }}"></i>  <a href="{{ url }}">{{ crumb }}</a>
    </li>
  {% endfor %}
{% endblock %}

{% block content %}
<div class="body-content">
<div class="row">
  <div class="col col-xs-6">
    <div class="btn-group">
      <button id="reset_date" type="button" class="btn btn-primary">Select Date Range</button>
      <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <span class="caret"></span>
        <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu">
        <li><a id="30days" href="#">30 days</a></li>
        <li><a id="14days" href="#">14 days</a></li>
        <li><a id="7days" href="#">7 days</a></li>
      </ul>
    </div>

  </div>

</div>
<script type="text/javascript">

var today = moment().subtract(1, 'days').format("YYYY-MM-DD");

  $('#30days').click(function () {
  var account_id = {{ account_id|safe }};
  var thirtyDaysAgo = moment().subtract(31, 'days').format("YYYY-MM-DD");
  var url = "/users/dashboard/graph/update/" + account_id + "/" + thirtyDaysAgo + "/" + today;
    $.ajax({
        type: 'GET',
        url: url,
        success: function (data) {
            console.log(data);
            myChart.data.datasets[0].data = data.production_net_usage_percentage_graph.production_percentage;
            myChart.data.datasets[1].data = data.production_net_usage_percentage_graph.net_input;
            myChart.data.datasets[2].data = data.production_net_usage_percentage_graph.net_usage_percentage;
            myChart.data.labels = data.production_net_usage_percentage_graph.labels;
            myChart.update();

            myChart2.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart2.data.datasets[1].data = data.production_net_usage_graph.net_usage;
            myChart2.data.labels = data.production_net_usage_graph.labels;
            myChart2.update();

            myChart3.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart3.data.datasets[1].data = data.net_usage_separated.net_usage_positive;
            myChart3.data.datasets[2].data = data.net_usage_separated.net_usage_negative;
            myChart3.data.labels = data.production_net_usage_graph.labels;
            myChart3.update();
        }
    });
  });

  $('#14days').click(function () {
  var account_id = {{ account_id|safe }};
  var thirtyDaysAgo = moment().subtract(15, 'days').format("YYYY-MM-DD");
  var url = "/users/dashboard/graph/update/" + account_id + "/" + thirtyDaysAgo + "/" + today;
    $.ajax({
        type: 'GET',
        url: url,
        success: function (data) {
            console.log(data);
            myChart.data.datasets[0].data = data.production_net_usage_percentage_graph.production_percentage;
            myChart.data.datasets[1].data = data.production_net_usage_percentage_graph.net_input;
            myChart.data.datasets[2].data = data.production_net_usage_percentage_graph.net_usage_percentage;
            myChart.data.labels = data.production_net_usage_percentage_graph.labels;
            myChart.update();

            myChart2.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart2.data.datasets[1].data = data.production_net_usage_graph.net_usage;
            myChart2.data.labels = data.production_net_usage_graph.labels;
            myChart2.update();

            myChart3.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart3.data.datasets[1].data = data.net_usage_separated.net_usage_positive;
            myChart3.data.datasets[2].data = data.net_usage_separated.net_usage_negative;
            myChart3.data.labels = data.production_net_usage_graph.labels;
            myChart3.update();
        }
    });
  });

  $('#7days').click(function () {
  var account_id = {{ account_id|safe }};
  var thirtyDaysAgo = moment().subtract(8, 'days').format("YYYY-MM-DD");
  var url = "/users/dashboard/graph/update/" + account_id + "/" + thirtyDaysAgo + "/" + today;
    $.ajax({
        type: 'GET',
        url: url,
        success: function (data) {
            console.log(data);
            myChart.data.datasets[0].data = data.production_net_usage_percentage_graph.production_percentage;
            myChart.data.datasets[1].data = data.production_net_usage_percentage_graph.net_input;
            myChart.data.datasets[2].data = data.production_net_usage_percentage_graph.net_usage_percentage;
            myChart.data.labels = data.production_net_usage_percentage_graph.labels;
            myChart.update();

            myChart2.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart2.data.datasets[1].data = data.production_net_usage_graph.net_usage;
            myChart2.data.labels = data.production_net_usage_graph.labels;
            myChart2.update();

            myChart3.data.datasets[0].data = data.production_net_usage_graph.production;
            myChart3.data.datasets[1].data = data.net_usage_separated.net_usage_positive;
            myChart3.data.datasets[2].data = data.net_usage_separated.net_usage_negative;
            myChart3.data.labels = data.production_net_usage_graph.labels;
            myChart3.update();
        }
    });
  });




</script>
<br>

    <div class="row">
      <div class="col col-xs-6">
        <canvas id="myChart3" width="380" height="200"></canvas>
      </div>
    </div>

    <div class="row">


  <div class="col col-xs-6">
    <canvas id="myChart" width="380" height="200"></canvas>
  </div>

  <div class="col col-xs-6">
    <canvas id="myChart2" width="380" height="200"></canvas>
  </div>
</div>

<script>

var data = {
labels: {{ prod_net_usg_pct['labels']|safe }},
datasets: [
    {
        label: 'Production %',
        backgroundColor: "rgba(43,83,207,0.2)",
        borderColor: "rgba(25,60,168,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(43,83,207,0.4)",
        hoverBorderColor: "rgba(25,60,168,1)",
        data: {{ prod_net_usg_pct['production_percentage']|safe }},
    },
    {
        label: 'Net Input %',
        backgroundColor: "rgba(127,191,63,0.2)",
        borderColor: "rgba(9,174,9,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(127,191,63,0.4)",
        hoverBorderColor: "rgba(9,174,9,1)",
        data: {{ prod_net_usg_pct['net_input']|safe }},
    },
    {
        label: 'Net Usage %',
        backgroundColor: "rgba(168,25,25,0.2)",
        borderColor: "rgba(138,16,16,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(168,25,25,0.4)",
        hoverBorderColor: "rgba(138,16,16,1)",
        data: {{ prod_net_usg_pct['net_usage_percentage']|safe }},
    },
]
};
var ctx = document.getElementById("myChart");
var myChart = new Chart(ctx, {
  type: 'bar',
  data: data,
  options: {
      scales: {
          yAxes: [{
              stacked: true,
              ticks: {
                  beginAtZero:true
              }
          }],
          xAxes: [{
              stacked: true
          }]
      }
  }
});
</script>

<script>
var data = {
labels: {{ prod_net_usg['labels']|safe }},
datasets: [
    {
        label: 'Production kWh',
        backgroundColor: "rgba(43,83,207,0.2)",
        borderColor: "rgba(25,60,168,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(43,83,207,0.4)",
        hoverBorderColor: "rgba(25,60,168,1)",
        data: {{ prod_net_usg['production']|safe }},
    },
    {
        label: 'Net Usage',
        backgroundColor: "rgba(168,25,25,0.2)",
        borderColor: "rgba(138,16,16,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(168,25,25,0.4)",
        hoverBorderColor: "rgba(138,16,16,1)",
        data: {{ prod_net_usg['net_usage']|safe }},
    }
]
};
var ctx = document.getElementById("myChart2");
var myChart2 = new Chart(ctx, {
  type: 'bar',
  data: data,
  options: {
      scales: {
          yAxes: [{
              stacked: true,
              ticks: {
                  beginAtZero:true
              }
          }],
          xAxes: [{
              stacked: true
          }]
      }
  }
});

var data2 = {
labels: {{ prod_net_usg['labels']|safe }},
datasets: [
    {
        type: 'line',
        label: 'Production kWh',
        backgroundColor: "rgba(43,83,207,0.2)",
        borderColor: "rgba(25,60,168,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(43,83,207,0.4)",
        hoverBorderColor: "rgba(25,60,168,1)",
        data: {{ prod_net_usg['production']|safe }},
    },
    {
        type: 'bar',
        label: 'Net Usage',
        backgroundColor: "rgba(168,25,25,0.2)",
        borderColor: "rgba(138,16,16,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(168,25,25,0.4)",
        hoverBorderColor: "rgba(138,16,16,1)",
        data: {{ prod_comb['net_usage_positive']|safe }},
    },
    {
        type: 'bar',
        label: 'Net Usage',
        backgroundColor: "rgba(127,191,63,0.2)",
        borderColor: "rgba(127,191,63,1)",
        borderWidth: 1,
        hoverBackgroundColor: "rgba(127,191,63,0.4)",
        hoverBorderColor: "rgba(127,191,63,1)",
        data: {{ prod_comb['net_usage_negative']|safe }},
    }
]
};
var ctx2 = document.getElementById("myChart3");
var myChart3 = new Chart(ctx2, {
  type: 'bar',
  data: data2,
  options: {
      scales: {
          yAxes: [{
              stacked: true,
              ticks: {
                  beginAtZero:true
              }
          }],
          xAxes: [{
              stacked: true
          }]
      }
  }
});
</script>




    </div>
</div>
{% endblock %}
