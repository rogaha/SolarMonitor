
{% extends "layout.html" %}

{% block content %}
<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron">
 
  <div class="row">
      <div class="col-md-4">
  <form class="form-horizontal" action="{{ url_for('dashboard.charts') }}" method="post">
    {{ download_data_form.hidden_tag() }}
  <fieldset>

  <!-- Form Name -->
  <legend>Import PGE Data</legend>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">Start Date</label>
    <div class="col-md-6">
    {{ download_data_form.start_date(class="form-control input-md", id="datepicker1", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker1').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">End Date</label>
    <div class="col-md-6">
    {{ download_data_form.end_date(class="form-control input-md", id="datepicker2", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker2').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>


  <!-- Button -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton"></label>
    <div class="col-md-6">
      {{ download_data_form.submit(class="btn btn-primary") }}
    </div>
  </div>



  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton"></label>
    <div class="col-md-6">
        <div id="success_text" style="visibility:hidden">
        <input class="btn btn-success" value="Get New Data" onClick="location.href='/charts';">
        </div>

        <div class="progress" style="visibility:hidden" id="progress_bar">
          <div id="percent_bar" class="progress-bar progress-bar-success progress-bar-striped active" style="min-width: 2em;" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">
            0%
          </div>
        </div>
    </div>
  </div>

</fieldset>
</form>

</div>
<div class="col-md-4">
  <form class="form-horizontal" action="{{ url_for('dashboard.charts') }}" method="post">
    {{ date_select_form.hidden_tag() }}
  <fieldset>

  <!-- Form Name -->
  <legend>Select Data to View</legend>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">Start Date</label>
    <div class="col-md-6">
    {{ date_select_form.start_date(class="form-control input-md", id="datepicker3", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker3').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- Text input-->
  <div class="form-group">
    <label class="col-md-4 control-label" for="textinput">End Date</label>
    <div class="col-md-6">
    {{ date_select_form.end_date(class="form-control input-md", id="datepicker4", autocomplete="off") }}

    <script type="text/javascript">

    $(document).ready(function() {
        $('#datepicker4').datepicker({
          format: 'yyyy-mm-dd',
        });
    })
    </script>

    </div>
  </div>

  <!-- SelectField -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton">Time Unit</label>
    <div class="col-md-4">
      {{ date_select_form.data_time_unit(class="form-control input-md") }}
    </div>
  </div>

  <!-- Button -->
  <div class="form-group">
    <label class="col-md-4 control-label" for="singlebutton"></label>
    <div class="col-md-4">
      {{ date_select_form.submit(class="btn btn-primary") }}
    </div>
  </div>

  </fieldset>
  </form>
</div>
</div>
</div><!-- /.jumbotron -->
<style type="text/css">
.datepicker {
margin-top:50px

}
</style>
<div class="row">
    <div class="col-sm-6">

    <canvas id="myChart" width="100" height="100"></canvas>

    <script>
    var data = {
    labels: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_label|safe }} {% else %}  {{ outgoing_labels|safe }} {% endif %},
    datasets: [
        {
            label: 'Outgoing Electric (Sold to Grid) kWh',
            backgroundColor: "rgba(127,191,63,0.2)",
            borderColor: "rgba(9,174,9,1)",
            borderWidth: 1,
            hoverBackgroundColor: "rgba(127,191,63,0.4)",
            hoverBorderColor: "rgba(9,174,9,1)",
            data: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_data|safe }} {% else %}  {{ outgoing_electric|safe }} {% endif %},
        },

        {
            label: 'Incoming Electric (Usage) kWh',
            backgroundColor: "rgba(255,99,132,0.2)",
            borderColor: "rgba(255,99,132,1)",
            borderWidth: 1,
            hoverBackgroundColor: "rgba(255,99,132,0.4)",
            hoverBorderColor: "rgba(255,99,132,1)",
            data: {% if session['data_time_unit'] == "Daily"%} {{ incoming_electric_daily_data|safe }} {% else %}  {{ incoming_electric|safe }} {% endif %},
        }
    ]
};
    var ctx = document.getElementById("myChart");
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: data,
      options: {
          scales: {
              yAxes: [{
                  ticks: {
                      beginAtZero:true
                  }
              }]
          }
      }
    });
    </script>

    </div>


    <div class="col-sm-6">

      <canvas id="myChart3" width="100" height="100"></canvas>

      <script>
      var ctx = document.getElementById("myChart3");
      var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: {% if session['data_time_unit'] == "Daily"%} {{ outgoing_electric_daily_label|safe }} {% else %}  {{ outgoing_labels|safe }} {% endif %},
            datasets: [{
                label: 'Combined Electric (+/-) kWh',
                data: {% if session['data_time_unit'] == "Daily"%}{{ daily_combined_electric_usage|safe }} {% else %}{{ hourly_combined_electric_usage|safe }}{% endif %} ,
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero:true
                    }
                }]
            }
        }
      });
      </script>

    </div>
</div>

<div class="row">
    <div class="col-sm-4">

      <p>Debug Data</p>


<script type='text/javascript'>

(function poll() {
    setTimeout(function() {
        $.ajax({
            url: "/status/task_check",
            type: "GET",
            success: function(data) {

                console.log(data);
                for (var key in data) {
                    $("#progress_bar").removeAttr("style")
                    var task_id = data[key];
                    $.ajax({
                      url: "/status/" + data[key],
                      type: "GET",
                      success: function(data) {
                        console.log(data['current'])
                        console.log(data['total'])
                        var percentage = ((data['current'] / data['total']) * 100).toFixed(1)
                        console.log(percentage)
                        console.log(data)
                        $("#progress_bar").find('#percent_bar').css({"min-width":"2em", "width": percentage + '%'});
                        $("#progress_bar").find('#percent_bar').text(percentage + '%');
                        if (data['state'] === 'SUCCESS') {
                          $("#progress_bar").find('#percent_bar').css({"min-width":"2em", "width": '100%'});
                          $("#progress_bar").find('#percent_bar').text('100%');
                          $("#progress_bar").css({'visibility': 'hidden'});
                          $.ajax({
                            url: "/status/" + task_id + '/mark_complete',
                            type: "GET",
                            success: function(data) {
                              $("#success_text").removeAttr("style");
                              console.log( "<p>" + data['response'] + "</p>" );
                            }
                          })
                        }
                        if (data['state'] === 'FAILURE') {
                          $("#progress_bar").find('#percent_bar').css({"min-width":"2em", "width": '100%'});
                          $("#progress_bar").find('#percent_bar').text('Import Failed');
                          $("#progress_bar").css({'visibility': 'hidden'});
                          $.ajax({
                            url: "/status/" + task_id + '/mark_complete',
                            type: "GET",
                            success: function(data) {
                              $("#success_text").removeAttr("style");
                              $("#success_text").text('Import Failed');
                              console.log( "<p>" + data['response'] + "</p>" );
                            }
                          })
                        }
                      }
                    })

                }
            },
            dataType: "json",
            complete: poll,
            timeout: 1000
        })
    }, 1000);
})();

</script>



  <p>Start Date: {{ session['start_date_pge'] }}<br>

  End Date:{{ session['end_date_pge'] }}</br><br>

  <a class="btn btn-primary" href="{{ url_for('dashboard.charts', modify='clear') }}"> Clear Session</a>

  <a class="btn btn-primary" href="{{ url_for('dashboard.charts', modify='delete-data') }}"> Clear Database</a>

  </p>

  <hr>
  Incoming Electric Daily Data<br>
  {{ incoming_electric_daily_data }}
  <hr>
  Incoming Electric Daily Labels<br>
  {{ incoming_electric_daily_label}}
  <hr>
  Incoming Electric Hourly Labels<br>
  {{ incoming_labels|safe }}
  <hr>
  Incoming Electric Hourly Data <br>
  {{ incoming_electric|safe }}
  <hr>
  Outgoing Electric Hourly Labels <br>
  {{ outgoing_labels|safe }}
  <hr>
  Outgoing Electric Hourly Data <br>
  {{ outgoing_electric|safe }}

  <br><br><br><br>



    </div>
  </div>

{% endblock %}
